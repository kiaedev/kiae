devops

# 目标

设计一款以应用为中心，易用性高，帮助企业有效提升研发效率的Devops平台。

以应用为中心的意思是：不要公有云产品那种以产品为中心的设计，因为这种设计本质上是为了卖产品。
而Devops平台的使用场景是：研发人员构建和部署自己应用的地方。

有效提升研发效率指的是：通过设计一个围绕应用为中心的，可扩展的Workflow系统，将应用从最初的创建，到日常的构建部署及管理，再到生命结束下线删除，实现完整的自动化流程。尽量减少研发人员的使用成本。

比如，下面是一个典型的流程：

1. 点击【创建应用】按钮填写应用信息表单，包含名称、描述、级别、类型、代码仓库和所依赖的中间件。
2. 这时应用的状态为NotReady，此时系统会自动去申请中间件资源，当中间件申请成功后将会把连接信息自动写入Secret。
3. 点击【构建】按钮，选择要构建的代码版本即可触发构建
4. 点击【发布】按钮，选择构建出来的镜像即可完成发布。这时系统会自动把步骤2中产生的Secret注入到Pod中（可以是Env或配置文件），
5. A fewer months or years later...
6. 点击【下线】按钮，触发下线审批流程。

# 设计

## 中间件自动申请及注入
一般应用都需要MySQL和Redis。当应用选择了这两个中间件后，系统自动调用相关中间件的接口，这时进入中间件的申请流程（比如需要审批）。
系统会采用长轮询的方式等待申请结果，当申请通过后，系统自动将连接信息写入K8S的Secret资源。

这里的重点是：需要定义一个连接信息的标准，这样就能保证中间件管理方给出的连接信息业务方能够直接使用。

## 应用详情
Overview
1. 名称
2. 描述
3. 代码仓库
4. 监控图表
5. 构建/发布/配置调整

Tabs
1. Log
2. Event
3. Config
4. Volume
5. Middleware

## 构建
为了应对多种多样的编程语言，我们通过模板的方式编写Dockerfile。
因为业界有很多种构建工具，这里我们采用可扩展的方式，可以实现随时切换为不同的构建工具

## 部署
采用ArgoRollout可以实现多种发布策略

## 其他
- 构建历史
- 部署历史

# 实现

可能用到的技术栈

- ArgoRollout
- ArgoWorkflow
- KubeVela
